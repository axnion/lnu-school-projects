# -*- mode: ruby -*-
# vi: set ft=ruby :

Vagrant.configure(2) do |config|
    config.vm.box = "ubuntu/yakkety64"
    #config.vm.network :forwarded_port, guest: 7000, host: 8080
    config.vm.network :forwarded_port, guest: 80, host: 8080

    config.vm.provision :shell, inline: <<-SHELL
        apt-get update
        #apt-get -y upgrade

        apt-get -y remove ruby

        echo 'Installing core dependencies'
        apt-get -y install git-core curl build-essential gcc libssl-dev libreadline-dev

        echo 'Installing dependencies for rvm'
        apt-get -y install libgdbm-dev libncurses5-dev automake libtool bison libffi-dev

        echo 'Installing dependencies for Hours'
        apt-get -y install postgresql libpq-dev memcached
        apt-get -y install qt5-default libqt5webkit5-dev gstreamer1.0-plugins-base gstreamer1.0-tools gstreamer1.0-x
        apt-get -y install nodejs npm

        echo 'Installing crystal-lang'
        curl https://dist.crystal-lang.org/apt/setup.sh | sudo bash
        apt-key adv --keyserver keys.gnupg.net --recv-keys 09617FD37CC06B54
        echo "deb https://dist.crystal-lang.org/apt crystal main" > /etc/apt/sources.list.d/crystal.list
        apt-get update
        apt-get install crystal
    SHELL



    # Setting up Hours
    config.vm.provision :shell, privileged: false, inline: <<-SHELL
        echo 'Installing Hours'
        cd /vagrant
        rm -rf hours
        git clone https://github.com/DefactoSoftware/Hours.git /vagrant/hours

        cd hours
        ./bin/setup
    SHELL


end
