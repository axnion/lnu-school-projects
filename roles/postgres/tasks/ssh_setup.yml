---
  - name: check if key-pair exists
    stat: path=/home/vagrant/.ssh/id_rsa
    register: key_file

  - name: generate SSH key-pair
    shell: ssh-keygen -b 2048 -t rsa -f /home/vagrant/.ssh/id_rsa -q -N ""
    when: key_file.stat.exists == False

  - name: copy public key to tmp dir
    fetch:
      src: /home/vagrant/.ssh/id_rsa.pub
      dest: /tmp/
      flat: yes
