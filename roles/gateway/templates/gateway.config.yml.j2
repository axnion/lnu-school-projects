# Ports for gateway.
# Do not touch!
# Ports located in inventory
http:
  port: {{ port_used }}
admin:
  port: {{ admin_port }}
  hostname: localhost

# API Endpoint on the Gateway
apiEndpoints:
  {{serviceA}}:
    host: localhost
    paths: /{{ serviceA }}
  {{serviceB}}:
    host: localhost
    paths: /{{ serviceB }}

# API Endpoints on the services
serviceEndpoints:
  {{serviceA}}:
    url: {{serviceAURL}}
  {{serviceB}}:
    url: {{serviceBURL}}

# Enabled policies
policies:
  - expression
  - proxy

# Pipelines from Gatway endpoints to Service Endpoints
pipelines:
  servicea:
    apiEndpoints:
      - {{serviceA}}
    policies:
      - expression:
          condition:
            name: pathExact
            path: {{serviceA2}}
          action:
            jscode: 'req.url = "{{serviceARoot}}"; '
      - proxy:
          action:
            serviceEndpoint: {{serviceA}}
  serviceb:
    apiEndpoints:
      - {{serviceB}}
    policies:
      - expression:
          condition:
            name: pathExact
            path: {{serviceB2}}
          action:
            jscode: 'req.url = "{{serviceBRoot}}"; '
      - proxy:
          action:
            serviceEndpoint: {{serviceB}}
