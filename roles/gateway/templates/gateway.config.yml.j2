# Ports for gateway.
# Do not touch!
# Ports located in inventory
http:
  port: {{ port_used }}
admin:
  port: {{ admin_port }}
  hostname: localhost

# API Endpoint on the Gateway
apiEndpoints:
  serviceA:
    host: localhost
    paths: '/serviceA'
  serviceB:
    host: localhost
    paths: '/serviceB'

# API Endpoints on the services
serviceEndpoints:
  serviceA:
    url: 'http://{{ hostvars['littleboy1']['ansible_host'] }}:{{ littleboy_port }}'
  serviceB:
    url: 'http://{{ hostvars['fatman1']['ansible_host'] }}:{{ fatman_port }}'

# Enabled policies
policies:
  - expression
  - proxy

# Pipelines from Gatway endpoints to Service Endpoints 
pipelines:
  servicea:
    apiEndpoints:
      - serviceA
    policies:
      - expression:
          condition:
            name: pathExact
            path: /servicea
          action:
            jscode: 'req.url = "/hello"; '
      - proxy:
          action:
            serviceEndpoint: serviceA
            changeOrigin: false
  serviceb:
    apiEndpoints:
      - serviceB
    policies:
      - expression:
          condition:
            name: pathExact
            path: /serviceb
          action:
            jscode: 'req.url = "/"; '
      - proxy:
          action:
            serviceEndpoint: serviceB
            changeOrigin: false
